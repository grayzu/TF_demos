trigger:
  batch: true
  branches:
    include:
    - master
  paths:
    include:
    - Demo1/*
    - azure-pipelines-demo1.yml
    - azure-pipelines-terraform-release.yml

pr:
  autoCancel: true
 
variables:
  sandboxAzureSubscription: 'MTC Denver Sandbox'
  productionAzureSubscription: 'MTC Denver Production'
  storageAccountRg: demo-terraform-sandbox-rg
  storageAccountName: mtcdenterraformsandbox
  workingDirectory: '$(System.DefaultWorkingDirectory)/Demo1'
  location: 'West US 2'

stages:

# Deploy to Staging
- stage: Staging
  jobs:
  - template: azure-pipelines-terraform-release.yml
    parameters:
      storageAccountRg: $(storageAccountRg)
      storageAccountName: $(storageAccountName)
      storageAccountKey: $(storageAccountKey)
      azureSubscription: $(sandboxAzureSubscription)
      workingDirectory: $(workingDirectory)
      loc: $(location)
      rg: 'hashiconf-demo1-staging-rg'
      

# Deploy to Production
- stage: Production
  jobs:
  - template: azure-pipelines-terraform-release.yml
    parameters:
      storageAccountRg: $(storageAccountRg)
      storageAccountName: $(storageAccountName)
      storageAccountKey: $(storageAccountKey)
      azureSubscription: $(productionAzureSubscription)
      workingDirectory: $(workingDirectory)
      loc: $(location)
      rg: 'hashiconf-demo1-production-rg'
      